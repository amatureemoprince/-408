## 知识总览
![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1736750446436-bf37d68b-545b-4477-9062-bb7df4cad3ac.jpeg)

随机访问介质的意思是在信道的上的各个节点可以随机的发送数据

![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1736689533041-f8dca0ae-b58a-42a7-9871-d02109c21852.jpeg)

## ALOHA 协议（在夏威夷语中有 爱、同情等意思）
### 纯 ALOHA 协议
只要节点准备好数据帧就可以直接发送。

因为在数据传输的过程可能受到其他节点的干扰所以有一个收到 ACK的机制：一个节点在发送一个数据帧后会等待接收放返回一个 ACK，如果超时没有返回的话就会重新传输，出现冲突的话就会随机等待一个时间再发送数据帧，否则继续准备下一个数据帧。

为什么会使用随机时间呢？因为如果是固定的时间的话，在一次冲突后后面的必然是冲突。

### 时隙 ALOHA 协议
时隙 ALOHA 协议的时隙大小固定为传输一个数据帧的时间大小，只有在每个时隙开始时才发送数据帧

![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1736690416902-414527d0-75ee-4ba1-bb47-190936512b84.png)

这样的话会降低发生冲突的概率，避免了用户的随意性，提高了信道的利用率。上面的纯 ALOHA 协议只要准备好就发送太容易碰在一起了。当然也是可能发生冲突的，解决方案跟上面的一样，发生冲突各个节点随机等待一段时间再发送就可以了

## CSMA 协议（载波监听多路访问协议）
是对 ALOHA 协议的升级，每次在发送之前先监听信道是否空闲，只有在信道是空闲的时候才进行发送。

### 1-坚持 CSMA 协议
A 节点在发送数据，B 节点的数据帧已经准备好了，B 会一直监听这个信道是否有数据传输。一旦监听到没有则发送自己的数据帧。这就叫“1-坚持 CSMA 协议”，这里的“坚持”就体现出来了。当然还是可能发送冲突的，解决方法还是等待随机时间再重新发送

这个的优点就是信道利用率高，信道一旦空闲就马上有下一个节点继续使用，当然缺点也是非常明显的，就是如果有多个节点准备好数据的话，发生冲突的概率很大。为了解决这个问题就提出了非坚持 CSMA 协议

### 非坚持 CSMA 协议
A 节点在发送数据帧，然后 B、C 节点准备好了数据帧准备发送，先监听信道上有没有数据，有的话就不再监听并在随机时间后再次监听信道，没有数据传输才进行发送，这样的做法将各个节点发送数据帧错开了，降低了发生冲突的概率了。

那么优点就是当多个节点的数据都已经准备好时，如果信道不空闲，则各节点会随机推迟一段时间再尝试监听，从而使各节点错开发送时机，降低冲突概率。缺点就是在信道刚恢复空闲时，可能不会立即利用，导致信道利用率低。

### p-坚持 CSMA 协议
这个呐就是前两个的折中表现，A 节点发送数据帧，B、C 节点准备好了数据帧然后监听信道，如果有数据，就一直监听，直到没有数据此时各节点发送数据帧的概率为 p，就是说有 p 的概率直接就发送了，还有 1-p 的概率推迟随机时间后再发送数据帧。这样相较于非坚持 CSMA 协议提高了信道利用率，相较于 1-坚持 CSMA 协议降低了冲突概率。

### CSMA/CD 协议（难点且重点）
用于早期的有线以太网，在 CSMA 监听的特性上再加上冲突检测的特性

![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1736906633470-92849964-663b-44a6-8505-520f068544af.jpeg)

A 节点发送数据帧，B 节点准备好了数据帧，但是此时信道上存在数据，所以会坚持监听，直到没有数据在信道上了后立即发送数据帧并且会边发送边监听信道上有没有其他节点发送数据，如果有的话 B 节点会停止发送数据帧，随机等待时间后再次发送。如果没有检测到其他节点发送数据则认为没有冲突为发送成功。

**现在需要重点了解的是如果发送冲突应该怎样解决：**

在 B 节点发送数据帧后，C 节点的数据帧也准备好了数据帧，此时 C 节点检测信道，因为 B 发送的数据还没有到达 C 节点，所以 C 节点认为此时信道上是没有数据的，也发送了数据帧，但是发送了一小会儿 B 发送的数据到达了 C 节点，因为 C 节点会一直监听信道，所以在 C 节点检测到了 B 节点发送的数据后马上停止发送数据帧并检测是第几次发送冲突，设发生冲突的次数为 k，若 k<16 就在 [0，2^k - 1] 中随机选择一个值 r 并乘以争用期就可以得到一个随机等待的时间，在这里 k=10 是一个分水岭，k 大于 10 的话 k 还是以 k=10 选取随机数 r。若 k>16 则报告上级表示实在是太拥堵了。

#### 争用期
**争用期=2 x 最大单向传播时延**

在争用期内没有检测到冲突则表明这个节点不会再遇到冲突了，那么这是为什么呢？

假设：

A 在最左侧，B 在最右侧，在 A 发送数据帧后还差一点点时间就到了 B 但总归还差了点，就在这一点点时间里 B 节点发送了数据帧，马上 B 节点就接收到了 A 节点传输过来的数据，此时 B 就不用再传输数据了。但是 A 节点此时并不知道发生冲突了，因为 B 节点传输的数据还需要一个单向传播时延，这种情况是最极限的情况了，除此之外的所有情况检测到冲突的时间都比这个少。而且只要 A 节点的数据帧到达了 B 节点时信道就已经被 A 节点的数据占满了，其他节点在监听时也会知道不能发送数据帧，所以说在争用期内没有发生冲突就不会再发生冲突了。

#### 最短帧长
**最短帧长=2 x 最大单向传播时延 x 信道带宽；若收到的帧小于最短帧长则视为无效帧**

这个是为了避免节点没有检测到冲突但实际上发生了冲突的情况

假设：

A、B 位置如上假设

A 节点发送的数据帧长度比最短帧长还短的话，A 发送的数据帧到达 B 节点需要 30us，在 29us 时 B 节点发送数据帧，那么 A 发送数据帧发送完了，B 的数据才到 A 节点，这样的话 A 会认为是没有冲突的但是实际上已经发生冲突了。

#### 最长帧长
规定最长帧长可以防止某些节点一直占用信道。防止某个节点构造一个超级长的数据帧，这样这个信道就会被这个节点一直占用了。

### CSMA/CA 协议（难点但不是重点）
![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1736943970017-3458bfae-3f28-4ede-a245-22ecb3d89432.jpeg)

这个重点是避免冲突但不会完全避免。

DIFS（分布式协调 IFS）：最长的帧间间隔

SIFS：最短的帧间间隔，预留 SIFS 用于处理收到的帧（这个是 AP（发送信号灯的器件）进行预留的时间，比如用于差错控制等）

RTS：控制帧（相当于发送这个帧的节点要预约信道），其包括源地址，目的地址和这次通信所需的时间

CTS：控制帧（AP 同意预约给节点返回的帧）同时也广播出去让其他节点知道 AP 已经有约了



节点发送数据帧时先监听信道上有没有数据在发送，如果有则进行进行随机退避，有个专门的算法确定出应该退避的算法，而这个节点的退避时间只有信道是空闲才减少，如果没有再监听一个 DIFS 时间若信道上还是没有数据则进行发送数据帧，AP 收到后使用 SIFS 的时间进行处理一下。如果处理后发现有错误就不会返回 ACK，节点在长时间没有接收到 ACK 则会按上述的。 

还有个预约机制，就是节点给 AP 发送一个 RTS 帧，如果 AP 同意预约就返回一个 CTS 并将其广播给其他节点，让其他节点不干扰这个预约了的节点发送数据，这样也解决了隐蔽站的问题。这个功能可以开启和关闭，一般来说是根据数据帧的长度来判断是否开启，短的就不用开启，因为重传的代价小，长的就开启因为 RTS 帧重传的代价小。



                                                                                            

