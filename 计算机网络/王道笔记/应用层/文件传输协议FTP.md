# FTP 的工作原理
FTP 是因特网上使用得最广泛的文件传输协议。FTP 是提供交互式的访问，允许客户指明文件的类型和格式，并允许文件具有存取权限。它屏蔽了各种操作系统之间的不同，因此适用于异构网络中的任意计算机之间的传输文件。

FTP 提供以下功能：

+ 提供不同种类主机系统 （硬、软件体系等都可以不同）之间的文件传输能力
+ 以用户权限管理的方式提供用户对远程 FTP 服务器上的文件管理能力
+ 以匿名 FTP 的方式提供公用文件共享能力

其是采用的 C/S 工作方式，一个 FTP 进程可以同时为多个客户进程提供服务。并且 FTP 的服务器进程是由两大部分组成的。
一是：一个主进程，负责接收新的请求

二是：若干从属进程，负责处理单个请求

FTP 服务器必须在整个会话期间保留用户的状态信息

# 控制连接与数据连接
![](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1740314016032-adaeec38-8dbe-4bb2-b336-420f01c93c74.jpeg?x-oss-process=image/auto-orient,1)

FTP 在工作时使用两个并行的 TCP 连接：一个是控制连接（服务器端口号 21），一个数据连接（服务器端口号 20）。使用两个不同的端口号可以使协议更容易实现。

## 控制连接
服务器监听 21 号端口，等待客户进行连接，建立在这个端口上的连接称为控制连接，用来传输控制信息，不用来传输文件。因为在传输文件时还可以使用控制连接，所以在整个连接的会话期间要一直保持着打开状态。

## 数据连接
服务器端的控制进程在接收到 FTP 客户发来的文件传输请求后，就创建“数据传送进程”和“数据连接”。“数据连接”用来连接客户端和服务端的数据传送进程，数据传送进程实际完成文件的传送，在传送完成后关闭“数据传送连接”。

数据传送连接有两种传输模式：主动模式（PORT）和被动模式（PASV）

采用哪一种传输模式是由客户端决定。简单的来说，PORT 就是传输数据时服务器连接到客户端的端口，PASV 是相反的。

在使用 FTP 修改服务器上的文件时，需要先将服务器上的文件全部传送本机，然后在本机修改，最后将修改后的文件副本发送到服务器上，来回传送数据消费很多时间。而网络文件系统（NFS）采用的是一种更好的方式，它允许用户进程打开一个远程文件，并可以在该文件的某个特定位置开始读写数据，这样 NFS 可以让用户复制一个大文件中的一个很小的片段，而不需要复制整个大文件。



