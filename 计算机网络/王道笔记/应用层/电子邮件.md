# 电子邮件系统的组成结构
电子邮件是一种异步通信的方式，是不需要双方同时在场的。

一个电子邮件系统至少具备三个最主要的组成构件：

+ 用户代理
+ 邮件服务器
+ 电子邮件使用的协议（SMTP、POP3 、IMAP 等）

![](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1740355629686-3f47b8b5-e13d-4290-a1c7-dab3088e23af.jpeg?x-oss-process=image/auto-orient,1)

**用户代理（UA）**：用户与电子邮件系统的接口。用户代理向用户提供一个很友好的接口来发送和接受邮件，用户代理至少应当具有撰写、显示和邮件处理的功能。就是一个在客户端运行的软件，如 OutLook，Foxmail 等等。

**邮件服务器**：这个的功能是发送和接受邮件，同时还需要向发件人报告邮件传送的情况（已交付、被拒绝、丢失等）。它是采用 C/S 模式工作的，可以同时充当客户和服务器。也就是可以提供服务和请求服务，上面的图也可以看出来。

**邮件发送协议和读取协议**：邮箱在发送和接受时采用的是不同的协议，发送采用 SMTP 协议，接收采用 POP3 协议。这两种协议，SMTP 是使用的推（PUSH）的通信方式，你看邮箱是被 SMTP 客户推着到发送方服务器的，然后又被推到了接收方服务器，POP3 使用的拉（PULL）的通信方式，POP3 客户端在读取邮箱时会发送一个请求将在接收方邮件服务器上的邮件拉取下来。

需要注意的是发送的邮件只会在发送方服务器和接收方服务器上，不会出现在中间服务器上的。有点像点对点发送。

# 电子邮件格式和 MIME
## 电子邮件格式
有首部和主体部分组成。

在首部中有两个必填的关键字：To、From

还有个重要的是：Subject

这些在 Java 中都有具体的实现 api，这里就不需要多言了。直接上一张图吧。

![](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1740356946494-23a9799f-0996-4fb5-b24e-3bf141b22fb4.jpeg)

## 多用途因特网邮件扩展（MIME）
其实 SMTP 协议只能传输 7 位的 ASCII 码文本邮件，所以其他国家的各种符号，文字都无法进行传输，所以由于现实生活中存在的问题，就提出了 MIME。

MIME 并没有改动或取代 SMTP，而是相当于一个中间层，将邮件中的 ASCII 码进行转换。

![](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1740357389555-684af833-e243-4709-a344-7570975e662a.jpeg)
MIME 主要包括一下三部分内容：

1. 5 个新的邮件首部，包括 MIME 版本、内容描述、内容标识、传送编码和内容类型
2. 定义了许多邮件内容格式，对多媒体电子邮件的表示方法进行了标准化
3. 定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变

# SMTP 和 POP3
## 简单邮件传输协议（ SMTP）
该协议是一种可靠且有效的电子邮件传输的协议，它控制两个相互通信的 SMTP 进程交换信息。SMTP 使用的是 TCP 连接，端口号为 25。

SMTP 通信的过程有三个部分：

+ 连接建立
+ 邮件传递
+ 连接释放

## 邮局协议（ POP3） 和因特网报文存取协议（ IMAP）
两者都是读取邮件的协议，只是前者 IMAP 是简单且功能有限的，现在使用的版本是 POP3，在传输层上使用的 TCP，端口号是 110。

其接收方的用户代理上要运行 POP 客户程序，在接收方的邮件服务器中需要运行 POP 服务器程序。

它提供两种工作方式：下载并保留（用户读取了邮件，邮件还会在邮箱上）、下载并删除（用户读取了邮件，接收方服务器就会将该邮件进行删除）



后者提供许多联机命令，因此 IMAP 服务器需要维护会话用户的状态信息。并且其还可以允许用户代理只获取报文的某些部分（和文件下载那里的 NFS 相似哦）。



此外需要补充的是，随着万维网的流行，许多在此基础上建立的电子邮件也出现了。如：Hotmail、Gmail 等等。

此类电子邮件的特点是：用户浏览器与邮件服务器之间邮件的发送和接受使用的是 HTTP，在不同邮件服务器之间传送邮件时才使用 SMTP。











