# 用户数据报协议 UDP 概述
UDP 只在 IP 数据报服务之上增加了很少的功能，即复用分用和差错检测功能。

UDP 的主要特点：

+ UDP 是无连接的，减少开销和发送数据之前的时延
+ UDP 使用最大努力交付，即不保证可靠交付
+ UDP 是面向报文的，适合一次性传输少量数据的网络应用
+ UDP 无拥塞控制，适合很多实时应用
+ 首部开销小，只有 8B 而 TCP 是 20B

面向报文怎样理解呢，就是说应用层给的报文，在 UDP 这里直接发送完整的报文不会进行分段。所以不应该让 UDP 协议传输大的报文，因为这不仅会增加出错的可能性还会增加网络层的负担。

![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1740105938167-ae3a979e-8b17-44f0-9641-5945e8cb9b3d.png)

# UDP 首部格式
![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1740106225399-adf82b31-582b-4613-b614-63632f4dc6d9.png)

数据部分是可有可无的，所以 UDP 报文最小可以为 8B。在分用时，如果找不到对应的目的端口号，就会丢弃该报文，并向源主机发送一个 ICMP 报文（端口不可达）。

# UDP 校验
![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1740107978303-b627b2d4-fc9c-426b-a250-0931e5cf9168.png)

在计算检验字段之前需要先添加一个伪首部。这个伪首部不会向上和向下传递。这个伪首部这是用来帮助我们计算校验和的。类型字段使用 17 表示 UDP 协议。

怎样进行计算呢？

将伪首部和 UDP 数据报排在一起形成一个更大的数据，然后将其分为 2B 的小部分数据，如果这个大的数据包含的字节数是奇数，那么就需要在最后添加一个全为 0 的字节构成一个大的偶数字节的数据块。

将上面所有的 2B 数据进行相加，然后如果最高位需要进位就在结果的基础上+1（这个也称为反卷）

最后得出的结果取反码就是最后的校验和了。

这个算法是比较简单的，但是速度很快，所以适用于 UDP。

