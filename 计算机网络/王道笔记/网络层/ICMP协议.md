在数据传输的过程中难免会出错，网络层发现帧出错后会直接丢弃，然后还会给发送的主机返回一个 ICMP 报文告诉它出错了。



组成：虽然是将 ICMP 报文放入 IP 数据报中但是其仍是网络层的协议

![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1739450559376-535f1849-d591-4fbc-a8fb-b4010dab29a5.png)



# ICMP 差错报告报文（5 种）
## 1、终点不可达
当路由器或主机不能交付数据报时就向源节点发送终点不可达报文

## 2、源点抑制
如果路由器或者主机太拥塞就会给源节点返回源点抑制报文

## 3、时间超过
当路由器收到生存时间 TTL=0 的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报文片时，就把已收到的数据报文片全部丢弃，并返回这个报文。

## 4、参数问题
数据报的首部中的字段值有不正确时，就丢弃该数据报，并向源点发送参数问题报文。

## 5、改变路由（重定向）
路由发现自己不是最佳发送的会给源节点发送改变路由报文，让源节点换一个路由

# 不发送 ICMP 差错报文的情况
## 1、对 ICMP 差错报告报文不再发送 ICMP 差错报告报文
## 2、对第一个分片的数据报文的所有后续数据报片都不发送 ICMP 差错报告报文
## 3、对具有组播地址的数据报都不发送 ICMP 差错报告报文
## 4、对具有特殊地址（如 127.0.0.0 或 0.0.0.0）的数据报不发送 ICMP 差错报告报文


# ICMP 询问报文
## 1、回送请求和回答报文
主机或路由器向特定目的主机发出的询问，收到此报文的主机必须给源主机或路由器发送 ICMP 回答此报文。

测试目的站是否可达以及了解其相关状态

## 2、时间戳请求和回答报文
请某个主机或路由器回答当前的时间和日期。

用于进行时钟同步和测量时间

