# 知识总览
![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1739411088293-35c1276f-661e-4816-8b6a-7d53fe369342.jpeg)

# 各层协议的关系
![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1739369813025-7253f834-99ab-4a41-b255-be020ad99076.png)

这个 DHCP 协议是应用层的协议但是这里放到网络层来学习是因为这个是为网络层提供参数服务的。  

并且会使用到传输层的 UDP 协议和网络层的 IP 协议，最后封装为 MAC 帧。



1、 刚刚开始的时候新的主机没有自己的 IP 地址也不知道 DHCP 服务器的 IP 地址所以需要将目的 IP 地址设为广播地址，源 IP 地址为全 0，目的 MAC 地址全 1（广播帧），源 MAC 地址为自己的，这样才能将帧发送到 DHCP 服务器上。这就封装完第一个步骤需要的帧。
这个是一个广播帧意思是所有在这个局域网中的主机都会进行接收，那么处理 DHCP 服务器之外的主机是怎样处理的呢，其他主机在接收到这个广播帧后会一层一层的拆分，到了传输层数据时发现目的端口是 67，该主机就知道不是自己的了，因为这种专门的服务使用的端口是确定，其余的进程是不能分配的。

2、DHCP 服务器接收到了请求的报文后会进行返回，因为可以从请求的报文中得到客户主机的 MAC 地址，所以在 MAC 帧那里可以是有确定的目的 MAC 地址的，但是 IP 分组那里就没有确定的 IP 地址而是使用的广播帧，最重要的就是应用层的 DHCP 提供报文，给客户主机返回了租用 IP 地址、子网掩码、默认网关、租用时间等数据。

3、客户主机会向局域网中进行广播（不管是 IP 层还是 MAC 层）说明自己选择的 IP 地址是什么。
这里选择广播的原因是因为：在一个局域网中可能不止有一个 DHCP 服务器，所以在第一步后可能有多个 DHCP 服务器为其分配 IP，所以返回确认时需要进行广播告诉所有的 DHCP 服务器自己选择的 IP 是什么。

此时的客户还是没有 IP 的状态。

4、DHCP 服务器再进行一次 IP 层的广播，MAC 的单播（目的 MAC 地址为客户的 MAC 地址）还有 DHCP 确认报文，也就是之前的提供报文的内容。



经过上面的 4 个步骤就可以给客户主机分配一个 IP 地址了。





