还是 IP 地址消耗的问题越来越严重，在提出 CIDR 后依然存在，所以又出现了 NAT 技术，在现如今的大部分局域网中都使用了这种技术。

![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/48073730/1739276917882-43e222d9-3f4c-40be-ab37-68c546910623.jpeg)

# 端口号的概念
其实很简单，网络层实现了主机与主机之间的数据传输，但是主机上会有许许多多的进程，这些传输的数据需要知道是哪个进程需要撒，这个就是传输层需要做的事情，实现进程与进程之间的通信。每个主机对于进程的分配是独立的。传输层需要在 TCP（UDP）报文段的首部指明源端口号和目的端口号



# NAT 的执行过程
![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1739280912319-03b1d2c2-583d-4e39-8ee5-de076a133c44.png)

这个的原理和上面的端口号类似。使用对应的原理。

并且这个路由器实现了 NAT 功能，也就是维护了一个数据结构。外网 IP + 端口号 对应着 内网 IP + 端口号

外网是全球唯一的，内网可以在不同局域网中复用。所以需要实现复用的功能就必须使用一个唯一的 IP 进行对应，故使用外网与内网进行对应，并且内网中的主机有不同的进程所以 NAT 数据结构中还需要有个端口号。

数据需要传输到外网中，所以在经过 NAT 路由器需要对 IP 和端口号进行替换，出去是替换源，进入是替换目的，替换都是根据 NAT 路由器维护的一个表结构。

