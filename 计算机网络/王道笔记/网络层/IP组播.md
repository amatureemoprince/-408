# IP 数据报的三种传输方式
## 单播
单播用于发送数据包到单个目的地，且每发送一份单播报文都使用一个单播 IP 地址作为目的地址。是一种点对点传输方式。

## 广播
广播是指发送数据包到同一广播域或子网内所有设备的一种数据传输方式，是一种点对多传输方式。

## 组播
当网络中的某些用户需要特定数据时，组播数据发送者仅发送一次数据，借助组播路由协议为组播数据包建立组播分发树，被传递的数据到达距离用户端尽可能近的节点才开始复制和分发，是一种点对多的传输方式。



使用组播时发送数据的服务器只需要发送一份数据则可，只有在数据遇到岔路口的时候才会进行数据的复制，链路上都只会有一份数据。如果采用的是单播的话，有多少个主机需要接收，服务器就要准备多少份数据，并且在链路上大概率会存在多个相同的数据。

故：

**组播提高了数据传输效率，减少了主干网出现拥塞的可能性。组播组中的主机可以是在同一个物理网络，也可以是来自不同的物理网络（如果有 组播路由器-运行组播协议 的支持）**

# IP 组播地址
因为要实现一个源地址发送数据，然后多个特定的主机接受，肯定不能再使用它们原本的 IP 地址了，不然就是单播了。所以我们需要给在同一个组播的主机分配一个组播 IP 地址，使用的就是之前说过的 D 类地址，此地址是只能用于目的地址的。



关于 IP 组播需要注意的是：

1. 组播数据也是“尽最大努力交付”，不提供可靠交付，应用于 UDP
2. 对组播数据报不产生 ICMP 差错报文
3. 并非所有 D类地址都可以作为组播地址

组播可以分为在因特网范围内组播和硬件组播。就是前者在路由器上和路由器之间进行组播，后者在局域网内进行组播。

## 硬件组播
这个地方提一下则可：

因为是使用的组播 IP，所以需要在局域网中映射为该组播地址对应的组播 MAC 地址。

![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1740038949511-7057e19e-cf44-4d47-aed1-4350cecc0645.png)

在组播 MAC 地址中开头的必须是：01-00-5E，并且后面的 23 为是从组播地址的后 23 为来的，因为 D 类地址前 4 为定位 1110，所以还存在 5 为自由变化的 bit，所以可能存在有多个组播地址最后映射为相同的组播 MAC 地址了，故主机在收到多播数据报后还要在 IP 层利用软件进行过滤，把不是本机需要的数据进行过滤。

# IGMP 协议和组播路由选择协议
## 国际组管理协议 IGMP
IGMP 协议让路由器知道本局域网上是否有主机（的进程）参加或退出了某个组播组。将其视为整个网际协议 IP 的一个组成部分。

IGMP 工作的两个阶段：

1. 当某台主机加入新的多播组时，该主机向多播组的多播地址发送一个 IGMP 报文，表示自己要成为该组的成员。本地的多播路由器接收到后，还要利用多播路由选择协议，把这种组成员关系转发给互联网上的其他多播路由器。
2. 组成员是动态的，为了知道局域网上的主机还是不是组的成员，多播路由器需要周期性地探询。如果一个多播组中一个主机都没有回应，那么就认为该组的所有成员都已经离开了，也就不再把这个组的成员关系转发给其他的多播路由器了；只要该组中有一个主机回应，就认为这个组是活跃的。

## 组播路由选择协议
连接到局域网上的多播路由器还必须和互联网上的其他多播路由器协同工作，以便把多播数据报用最小的代价传送给所有组成员。这就叫同心协力。

组播路由选择协议最重要的就是要生成一颗组播转发树。发出数据的节点作为根节点，路由器为树上的其他节点。

![](https://cdn.nlark.com/yuque/0/2025/png/48073730/1740041854457-3d71e854-6d09-43e0-ad40-3c6c42477bee.png)





